{% extends "smartmin/base.html" %}

{% load charts %}
{% load compress %}
{% load i18n %}
{% load smartmin %}
{% load staticfiles %}

{% block pre-content %}
  {% include 'polls/pollrun_header.html' with pollrun=object %}
{% endblock pre-content %}

{% block extra-style %}
  {{ block.super }}
  {% compress css %}
    <link type="text/css" rel="stylesheet"
          href="{% static "libs/jqcloud-2.0.1/jqcloud.css" %}" />
    <link type="text/css" rel="stylesheet"
          href="{% static "libs/leaflet-0.7.7/leaflet.css" %}" />
  {% endcompress %}
{% endblock extra-style %}

{% block extra-script %}
  {{ block.super }}
  {% compress js %}
    <script src="{% static "libs/highcharts-4.1.8/highcharts.js" %}"></script>
    <script src="{% static "libs/jqcloud-2.0.1/jqcloud.js" %}"></script>
    <script src="{% static "libs/leaflet-0.7.7/leaflet.js" %}"></script>
    <script src="{% static "js/charts.js" %}"></script>
    <script src="{% static "js/poll-maps.js" %}"></script>
  {% endcompress %}
{% endblock extra-script %}

{% block content %}
  {% include "polls/maps_warning.html" %}

  {% for question, chart_type, chart_data, map_data, summary_table in question_data %}
    <div class="poll-question">
      <h3>
        {{ forloop.counter }}. {{ question.name }}
        {% if request.region %}
           / Region: {{ request.region }}
        {% endif %}
      </h3>

      {% if not map_data and chart_data %}
        <div class="alert alert-info">
          You don't currently have regions and boundaries linked, so the maps feature is unavailable. Edit your Region-Boundary relationships from Administration - Regions.
        </div>
      {% endif %}

      {% if display_maps and map_data and chart_data %}
        <ul class='nav nav-tabs' style='margin-bottom: 1em'>
          <li class='active'>
            <a class="tab_chart" href=''>
              {% trans "Chart" %}
            </a>
          </li>
          <li>
            <a class="tab_map" href=''>
              {% trans "Map" %}
            </a>
          </li>
        </ul>
      {% endif %}

      {% if display_maps and map_data or chart_data %}
        <div class="visual">
          {% if map_data %}
            <div class="map"
              {% for key, value in map_data.items %}
                 data-{{ key }}='{{ value|chart_json }}'
              {% endfor %}>
            </div>
          {% endif %}

          {% if chart_data %}
            <div class="chart-{{ chart_type }}"
                 data-chart='{{ chart_data|chart_json }}'
                 data-name="{{ question.name }}">
            </div>
          {% endif %}
        </div>
      {% else %}
        <div class="chart-no-data">
          {% trans "No data to display for this time period." %}
        </div>
      {% endif %}

      {% include "charts/summary_table.html" %}
    </div>
  {% empty %}
    <div>
      {% trans "There are no questions to display." %}
    </div>
  {% endfor %}
{% endblock content %}
